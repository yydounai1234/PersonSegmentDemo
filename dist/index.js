!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var a=t();for(var s in a)("object"==typeof exports?exports:e)[s]=a[s]}}(self,(()=>(()=>{"use strict";var e={d:(t,a)=>{for(var s in a)e.o(a,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:a[s]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var a=e.g.document;if(!t&&a&&(a.currentScript&&(t=a.currentScript.src),!t)){var s=a.getElementsByTagName("script");s.length&&(t=s[s.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();var t={};e.r(t),e.d(t,{qnPersonSegmentModel:()=>s});const a=new function(){return new Worker(e.p+"index.worker.js")},s=new class{constructor(){this.shouldStop=!1,this.videoElement=null,this.messageTask={},this.rawCanvas=null,this.rawCtx=null,this.stream=null,a.onmessage=e=>{const{id:t,data:a}=e.data;this.messageTask[t]&&(this.messageTask[t].resolve(a),delete this.messageTask[t])}}postMessage(e,t){const s=this.randomStringGen();return new Promise(((r,i)=>{a.postMessage({action:e,data:t,id:s}),this.messageTask[s]={resolve:r,reject:i}}))}dec2hex(e){return("0"+e.toString(16)).substr(-2)}randomStringGen(){const e=new Uint8Array(8);return window.crypto.getRandomValues(e),Array.from(e,this.dec2hex).join("")}async loadModel(e){return this.videoElement=e,await this.postMessage("init",{height:e.height,width:e.width})}async drawImageData(e,t,a){if(this.shouldStop)return!1;this.rawCtx.drawImage(t,0,0,this.rawCanvas.width,this.rawCanvas.height);const s=this.rawCtx.getImageData(0,0,this.rawCanvas.width,this.rawCanvas.height);(new Date).getTime();const r=await this.postMessage("perform",{imageData:s,bgImgData:a});(new Date).getTime();const i=e.getContext("2d"),n=await createImageBitmap(r);i.drawImage(n,0,0),requestAnimationFrame((()=>{this.drawImageData(e,t,a)}))}async perform(e,t,a={video:!0}){this.shouldStop=!1,this.rawCanvas=document.createElement("canvas"),this.rawCanvas.height=e.height,this.rawCanvas.width=e.width,this.rawCtx=this.rawCanvas.getContext("2d"),navigator.mediaDevices.getUserMedia(a).then((a=>{this.stream=a,this.videoElement.srcObject=a,requestAnimationFrame((()=>{this.drawImageData(e,this.videoElement,t)}))}))}stop(){if(this.shouldStop=!0,this.stream){const e=this.stream.getTracks();for(let t of e)t.stop()}}};return t})()));